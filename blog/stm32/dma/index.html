
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="DMA is used as an independent memory transfer between memory and peripherals that frees CPU from handling data exchange, therefore it speeds up the system performance. Understand about transfer modes, configure source and destination address. Example to copy data from memory to memory, or memory to a peripheral." name="description"/>
<meta content="embedded systems application programming" name="keywords"/>
<meta content="vqtrong" name="author"/>
<link href="https://www.codeinsideout.com/blog/stm32/dma/" rel="canonical"/>
<link href="../../../favicon.ico" rel="icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-7.1.3" name="generator"/>
<title>Direct Memory Access Management - Code Inside Out</title>
<link href="../../../assets/stylesheets/main.e35208c4.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.ef6f36e2.min.css" rel="stylesheet"/>
<meta content="#ffffff" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Noto Serif";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../../assets/extra.css" rel="stylesheet"/>
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-42618265-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<meta content="website" property="og:type"/>
<meta content="Code Inside Out - Direct Memory Access Management" property="og:title"/>
<meta content="DMA is used as an independent memory transfer between memory and peripherals that frees CPU from handling data exchange, therefore it speeds up the system performance. Understand about transfer modes, configure source and destination address. Example to copy data from memory to memory, or memory to a peripheral." property="og:description"/>
<meta content="https://www.codeinsideout.com/blog/stm32/dma/" property="og:url"/>
<meta content="https://www.codeinsideout.com/assets/banner.jpg" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1080" property="og:image:width"/>
<meta content="568" property="og:image:height"/>
</head>
<body data-md-color-accent="" data-md-color-primary="white" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#1-dma-controller">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Code Inside Out" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Code Inside Out">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Code Inside Out
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              DMA
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../">
        Blog
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../projects/">
      Projects
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../tags/">
      Tags
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Code Inside Out" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Code Inside Out">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg>
</a>
    Code Inside Out
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        Blog
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Blog" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Blog
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
        Recent posts
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
        Stm32
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Stm32" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          Stm32
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../intro/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../toolchain/">
        Tools and Docs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../semihosting/">
        Semihosting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../interrupt/">
        Interrupt
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../clock/">
        Clock
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gpio/">
        GPIO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../usart/">
        USART
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../redirection/">
        Redirection
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          DMA
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        DMA
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-dma-controller">
    1. DMA Controller
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-dma-channels">
    2. DMA Channels
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-dma-circular-mode">
    3. DMA Circular Mode
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-dma-interrupts">
    4. DMA Interrupts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-hal-software">
    5. HAL Software
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-lab-dma-memory-to-memory">
    6. Lab: DMA Memory to Memory
  </a>
<nav aria-label="6. Lab: DMA Memory to Memory" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-enable-dma">
    6.1. Enable DMA
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-generated-code">
    6.2. Generated code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-user-code">
    6.3. User code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-inspect-interrupts">
    6.4. Inspect interrupts
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-lab-dma-memory-to-uart-tx">
    7. Lab: DMA Memory to UART TX
  </a>
<nav aria-label="7. Lab: DMA Memory to UART TX" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-enable-dma-on-uart-tx">
    7.1. Enable DMA on UART TX
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-generated-code">
    7.2. Generated code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-user-code">
    7.3. User code
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-lab-dma-peripheral-to-memory">
    8. Lab: DMA Peripheral to Memory
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../timers/">
        Timer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../distance_us-100/">
        US-100
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
        Raspberry Pi
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Raspberry Pi" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          Raspberry Pi
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/notes/">
        Notes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/backup_sdcard/">
        Backup SDCard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/check_camera_i2c/">
        Diagnostic Camera
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/compile_ffmpeg/">
        Compile FFmpeg
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/resource_usage/">
        Resource usage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/setup_camera/">
        Setup Camera
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/stream_ffmpeg_hls_dash/">
        HLS/DASH Streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/stream_picamera_mjpeg/">
        MJPEG streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/stream_picamera_h264/">
        H264 streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/setup_headless/">
        Headless mode
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/setup_wifi_ap/">
        Wifi Access Point
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/save_power/">
        Save Power
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4">
        Setup blog
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Setup blog" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
          Setup blog
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup_blog/install_and_configure/">
        Install and configure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup_blog/markdown_syntax/">
        Markdown syntax
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup_blog/mkdocs_plugins/">
        MkDocs plugins
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup_blog/customize_theme/">
        Customize theme
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup_blog/print_to_pdf/">
        Print to PDF
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../projects/">
        Projects
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tags/">
        Tags
      </a>
</li>
</ul>
</nav>
<div class="tag-cloud-nav">
<br/>
<br/>
<br/>
<div style="font-weight:700; font-size:.7rem; margin:0 0.6rem;">
<label>Tag cloud</label>
</div>
<div style="padding: 0.4rem 0.6rem;">
<div class="tag-cloud">
<a class="tag" href="https://www.codeinsideout.com/tags/#grep">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkCyan;">grep
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#bash">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkBlue;">bash
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#h264">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">h264
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#i2c">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkMagenta;">i2c
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#backup">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGoldenrod;">backup
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mjpeg">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrchid;">mjpeg
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hardware accelerator">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">hardware accelerator
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#interrupt">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGoldenrod;">interrupt
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#markdown">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">markdown
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#vcp">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGoldenrod;">vcp
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#timer">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">timer
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mkdocs">
<span class="tag-name" style="font-size:0.8636363636363636rem;color:DarkSlateBlue;">mkdocs
            </span>
<sup class="tag-count">4</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#usart">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkCyan;">usart
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#semihosting">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOliveGreen;">semihosting
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#power">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOliveGreen;">power
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pwm">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">pwm
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gnuplot">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">gnuplot
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#awk">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateGray;">awk
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c++">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateGray;">c++
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#picamera">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkSlateBlue;">picamera
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkCyan;">c
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#clock">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateGray;">clock
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pi">
<span class="tag-name" style="font-size:1.4090909090909092rem;color:DarkSlateBlue;">pi
            </span>
<sup class="tag-count">10</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#debug">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkBlue;">debug
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#toolchain">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkViolet;">toolchain
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#omx">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">omx
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#access point">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">access point
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ffmpeg">
<span class="tag-name" style="font-size:0.6818181818181819rem;color:DarkCyan;">ffmpeg
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#redirect">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkViolet;">redirect
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name" style="font-size:1.5rem;color:DarkOrchid;">arm
            </span>
<sup class="tag-count">11</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gpio">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">gpio
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dash">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrange;">dash
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#uart">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkCyan;">uart
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#top">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkBlue;">top
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#headless">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">headless
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#performance">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrchid;">performance
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#restore">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">restore
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pulse">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">pulse
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#python">
<span class="tag-name" style="font-size:0.9545454545454546rem;color:DarkRed;">python
            </span>
<sup class="tag-count">5</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#v4l2">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateGray;">v4l2
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sensor">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">sensor
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#wifi">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOliveGreen;">wifi
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sdcard">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkBlue;">sdcard
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#capture">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">capture
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#distance">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">distance
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stream">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkSlateBlue;">stream
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#notes">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkGoldenrod;">notes
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name" style="font-size:1.5rem;color:DarkOrange;">stm32
            </span>
<sup class="tag-count">11</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dma">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOliveGreen;">dma
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hls">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">hls
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#camera">
<span class="tag-name" style="font-size:0.9545454545454546rem;color:DarkRed;">camera
            </span>
<sup class="tag-count">5</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#jinja">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">jinja
            </span>
<sup class="tag-count">1</sup>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-dma-controller">
    1. DMA Controller
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-dma-channels">
    2. DMA Channels
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-dma-circular-mode">
    3. DMA Circular Mode
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-dma-interrupts">
    4. DMA Interrupts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-hal-software">
    5. HAL Software
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-lab-dma-memory-to-memory">
    6. Lab: DMA Memory to Memory
  </a>
<nav aria-label="6. Lab: DMA Memory to Memory" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-enable-dma">
    6.1. Enable DMA
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-generated-code">
    6.2. Generated code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-user-code">
    6.3. User code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-inspect-interrupts">
    6.4. Inspect interrupts
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-lab-dma-memory-to-uart-tx">
    7. Lab: DMA Memory to UART TX
  </a>
<nav aria-label="7. Lab: DMA Memory to UART TX" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-enable-dma-on-uart-tx">
    7.1. Enable DMA on UART TX
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-generated-code">
    7.2. Generated code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-user-code">
    7.3. User code
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-lab-dma-peripheral-to-memory">
    8. Lab: DMA Peripheral to Memory
  </a>
</li>
</ul>
</nav>
<div class="tag-cloud-toc">
<br/>
<br/>
<br/>
<div style="font-weight:700; font-size:.7rem; margin:0 0.6rem;">
<label>Tag cloud</label>
</div>
<div style="padding: 0.4rem 0.6rem;">
<div class="tag-cloud">
<a class="tag" href="https://www.codeinsideout.com/tags/#gnuplot">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">gnuplot
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pulse">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">pulse
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#performance">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">performance
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pwm">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">pwm
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gpio">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrchid;">gpio
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#omx">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrange;">omx
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#usart">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">usart
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#python">
<span class="tag-name" style="font-size:0.9545454545454546rem;color:DarkGreen;">python
            </span>
<sup class="tag-count">5</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#capture">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOliveGreen;">capture
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#clock">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">clock
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name" style="font-size:1.5rem;color:DarkOrange;">stm32
            </span>
<sup class="tag-count">11</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#debug">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGoldenrod;">debug
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#bash">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkMagenta;">bash
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#vcp">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkMagenta;">vcp
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#headless">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkCyan;">headless
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sensor">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">sensor
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#notes">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkCyan;">notes
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hardware accelerator">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrange;">hardware accelerator
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name" style="font-size:1.5rem;color:DarkCyan;">arm
            </span>
<sup class="tag-count">11</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#timer">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">timer
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#i2c">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrchid;">i2c
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ffmpeg">
<span class="tag-name" style="font-size:0.6818181818181819rem;color:DarkOrange;">ffmpeg
            </span>
<sup class="tag-count">2</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hls">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkViolet;">hls
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mjpeg">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkMagenta;">mjpeg
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#access point">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGoldenrod;">access point
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#uart">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkCyan;">uart
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#redirect">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkMagenta;">redirect
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#power">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">power
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#distance">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">distance
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dma">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkBlue;">dma
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#camera">
<span class="tag-name" style="font-size:0.9545454545454546rem;color:DarkOrange;">camera
            </span>
<sup class="tag-count">5</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#wifi">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkCyan;">wifi
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#toolchain">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">toolchain
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#top">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrange;">top
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#picamera">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkBlue;">picamera
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#backup">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkBlue;">backup
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#awk">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrange;">awk
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c++">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkCyan;">c++
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#markdown">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkTurquoise;">markdown
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#grep">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGreen;">grep
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#interrupt">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkGoldenrod;">interrupt
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkRed;">c
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#v4l2">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateGray;">v4l2
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#jinja">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">jinja
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pi">
<span class="tag-name" style="font-size:1.4090909090909092rem;color:DarkSlateGray;">pi
            </span>
<sup class="tag-count">10</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dash">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrange;">dash
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#h264">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkMagenta;">h264
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sdcard">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateBlue;">sdcard
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#semihosting">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkOrchid;">semihosting
            </span>
<sup class="tag-count">1</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stream">
<span class="tag-name" style="font-size:0.7727272727272727rem;color:DarkCyan;">stream
            </span>
<sup class="tag-count">3</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mkdocs">
<span class="tag-name" style="font-size:0.8636363636363636rem;color:DarkMagenta;">mkdocs
            </span>
<sup class="tag-count">4</sup>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#restore">
<span class="tag-name" style="font-size:0.5909090909090909rem;color:DarkSlateGray;">restore
            </span>
<sup class="tag-count">1</sup>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<div class="page-cover">
<h1 class="page-title">Direct Memory Access Management</h1>
<p class="page-description">DMA is used as an independent memory transfer between memory and peripherals that frees CPU from handling data exchange, therefore it speeds up the system performance. Understand about transfer modes, configure source and destination address. Example to copy data from memory to memory, or memory to a peripheral.</p>
<p>
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name" style="color:DarkRed;">
                        #arm
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name" style="color:DarkBlue;">
                        #stm32
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dma">
<span class="tag-name" style="color:DarkGoldenrod;">
                        #dma
                    </span>
</a>
</p>
<p class="md-source-date">
<hr class="print-only"/>
<small>
                                
                                    Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 6, 2021</span><br/>
</small>
</p>
</div>
<div class="toc print-only">
<h2>Table of Content</h2>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-dma-controller">
    1. DMA Controller
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-dma-channels">
    2. DMA Channels
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-dma-circular-mode">
    3. DMA Circular Mode
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-dma-interrupts">
    4. DMA Interrupts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-hal-software">
    5. HAL Software
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-lab-dma-memory-to-memory">
    6. Lab: DMA Memory to Memory
  </a>
<nav aria-label="6. Lab: DMA Memory to Memory" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#61-enable-dma">
    6.1. Enable DMA
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#62-generated-code">
    6.2. Generated code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#63-user-code">
    6.3. User code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#64-inspect-interrupts">
    6.4. Inspect interrupts
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-lab-dma-memory-to-uart-tx">
    7. Lab: DMA Memory to UART TX
  </a>
<nav aria-label="7. Lab: DMA Memory to UART TX" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-enable-dma-on-uart-tx">
    7.1. Enable DMA on UART TX
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-generated-code">
    7.2. Generated code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-user-code">
    7.3. User code
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-lab-dma-peripheral-to-memory">
    8. Lab: DMA Peripheral to Memory
  </a>
</li>
</ul>
</nav>
</div>
<div class="btn-actions screen-only">
<p><a class="md-button" href="..\..\..\pdfs\blog\stm32\dma\stm32__DMA.pdf"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7z"></path></svg></span>PDF</a><a class="md-button" href="https://github.com/vuquangtrong/STM32_Tutorials/tree/main/f051_disco_dma_mem2mem"><span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> DMA Mem2Mem</a>
<a class="md-button" href="https://github.com/vuquangtrong/STM32_Tutorials/tree/main/f051_disco_dma_mem2uarttx"><span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> DMA Mem2UartTx</a></p>
</div>
<h2 id="1-dma-controller">1. DMA Controller<a class="headerlink" href="#1-dma-controller" title="Permanent link">⚓︎</a></h2>
<p>The <em>Direct Memory Access</em> (DMA) controller is a dedicated and programmable hardware unit that allows MCU peripherals to access to internal memories without the intervention of the Cortex-M core. The CPU is completely freed from the overhead generated by the data transfer (except for the overhead related to the DMA configuration), and it can perform other activities.</p>
<p>
<figure class="w70"><img src="hw_bus_architecture.png"/><figcaption>Bus architecture of and STM32F0 MCU</figcaption></figure>
</p>
<p>Some important things about DMA:</p>
<ul>
<li>Both the Cortex-M core and the DMA controller interact with the other MCU peripherals through a series of buses</li>
<li>Both the Cortex-M core and the DMA controller are masters, This means they are the only units that can start a transaction on a bus, but they cannot access to the same slave peripheral at the same time</li>
</ul>
<p>In every STM32 MCU, the DMA controller is a hardware unit that:</p>
<ul>
<li>has <em>two master</em> ports, named <em>peripheral</em> and <em>memory</em> port respectively, connected to the Advanced High-performance Bus (AHB), one able to interface a slave peripheral and the other one a memory controller (SRAM, flash, FSMC, etc.); in some DMA controllers a peripheral port is also able to interface a memory controller, allowing <em>memory-to-memory</em> transfers</li>
<li>has one <em>slave</em> port, connected to the AHB bus, used to program the DMA controller from the other master, that is the CPU</li>
<li>has a number of independent and programmable <em>channels</em> (request sources), each one connectable to a given peripheral request line (UART_TX, TIM_U, etc.)</li>
<li>allows to assign different <em>priorities</em> to channels, in order to arbitrate the access to the memory giving higher priority to faster and important peripherals</li>
<li>allows the data to flow in both directions, that is from <em>memory-to-peripheral</em> and from <em>peripheral-to-memory</em></li>
</ul>
<p>
<figure class="w50"><img src="hw_dma_controller.png"/><figcaption>DMA Controller</figcaption></figure>
</p>
<h2 id="2-dma-channels">2. DMA Channels<a class="headerlink" href="#2-dma-channels" title="Permanent link">⚓︎</a></h2>
<p>Each channel can handle DMA transfer between a peripheral register located at a fixed address and a memory address. The amount of data to be transferred (up to 65535) is programmable. The register which contains the amount of data items to be transferred is decremented after each transaction.</p>
<p>The transfer data sizes of the peripheral and memory are fully programmable through the <em>PSIZE</em> and <em>MSIZE</em> bits in the <em>DMA_CCRx</em> register.</p>
<p>Peripheral and memory pointers can optionally be automatically post-incremented after each transaction depending on the <em>PINC</em> and <em>MINC</em> bits in the _DMA_CCRx _register. If incremented mode is enabled, the address of the next transfer will be the address of the previous one incremented by 1, 2, or 4 depending on the chosen data size.</p>
<h2 id="3-dma-circular-mode">3. DMA Circular Mode<a class="headerlink" href="#3-dma-circular-mode" title="Permanent link">⚓︎</a></h2>
<p>The circular mode is available to handle circular buffers and continuous data flows (e.g. ADC scan mode). This feature can be enabled using the <em>CIRC</em> bit in the <em>DMA_CCRx</em> register. </p>
<p>When the circular mode is activated, the number of data to be transferred is automatically reloaded with the initial value programmed during the channel configuration phase, and the DMA requests continue to be served.</p>
<h2 id="4-dma-interrupts">4. DMA Interrupts<a class="headerlink" href="#4-dma-interrupts" title="Permanent link">⚓︎</a></h2>
<p>An interrupt can be produced on a Half-transfer, Transfer complete, or Transfer error for each DMA channel. Separate interrupt enable bits are available for flexibility.</p>
<h2 id="5-hal-software">5. HAL Software<a class="headerlink" href="#5-hal-software" title="Permanent link">⚓︎</a></h2>
<p>The Hardware Abstract Layer (HAL) is designed so that it abstracts from the specific peripheral memory mapping. But, it also provides a general and more user-friendly way to configure the peripheral, without forcing the programmers to now how to configure its registers in detail.</p>
<blockquote>
<p>excerpt from <a href="https://www.st.com/resource/en/user_manual/dm00122015-description-of-stm32f0-hal-and-lowlayer-drivers-stmicroelectronics.pdf">Description of STM32F0 HAL and low-layer drivers</a></p>
</blockquote>
<p><strong>How to use DMA HAL</strong></p>
<ol>
<li>
<p>Enable and configure the peripheral to be connected to the DMA Channel (except for internal SRAM / FLASH memories: no initialization is necessary). Please refer to Reference manual for connection between peripherals and DMA requests.</p>
</li>
<li>
<p>For a given Channel, program the required configuration through the following parameters: Transfer Direction, Source and Destination data formats, Circular or Normal mode, Channel Priority level, Source and Destination Increment mode, using <code>HAL_DMA_Init()</code> function.</p>
<div class="admonition note notitle">
<p class="admonition-title"> </p>
<p>In Memory-to-Memory transfer mode, Circular mode is not allowed</p>
</div>
</li>
<li>
<p>Use <code>HAL_DMA_GetState()</code> function to return the DMA state and <code>HAL_DMA_GetError()</code> in case of error detection.</p>
</li>
<li>
<p>Use <code>HAL_DMA_Abort()</code> function to abort the current transfer</p>
</li>
<li>
<p>Operation modes:</p>
<p><strong>Polling mode IO operation</strong></p>
<ul>
<li>
<p>Use <code>HAL_DMA_Start()</code> to start DMA transfer after the configuration of Source address and destination address and the Length of data to be transferred</p>
</li>
<li>
<p>Use <code>HAL_DMA_PollForTransfer()</code> to poll for the end of current transfer, in this case a fixed Timeout can be configured by User depending from the  application</p>
<div class="admonition warning notitle">
<p class="admonition-title"> </p>
<p>If DMA interrupt is enabled, this function may not work properly, read more in <a href="../notes/#dma-polling">Notes - DMA Polling</a></p>
</div>
</li>
</ul>
<p><strong>Interrupt mode IO operation</strong></p>
<ul>
<li>
<p>Configure the DMA interrupt priority using <code>HAL_NVIC_SetPriority()</code></p>
</li>
<li>
<p>Enable the DMA IRQ handler using <code>HAL_NVIC_EnableIRQ()</code></p>
</li>
<li>
<p>Use <code>HAL_DMA_Start_IT()</code> to start DMA transfer after the configuration of Source address and destination address and the Length of data to be transferred. In this case the DMA interrupt is configured</p>
</li>
<li>
<p>Use <code>HAL_DMA_Channel_IRQHandler()</code> called under <code>DMA_IRQHandler()</code> Interrupt subroutine</p>
</li>
<li>
<p>At the end of data transfer, <code>HAL_DMA_IRQHandler()</code> function is executed and user can add  a callback function by assigning function pointer <code>XferCpltCallback</code> and <code>XferErrorCallback</code> (i.e a member of DMA handle structure).</p>
</li>
</ul>
</li>
</ol>
<h2 id="6-lab-dma-memory-to-memory">6. Lab: DMA Memory to Memory<a class="headerlink" href="#6-lab-dma-memory-to-memory" title="Permanent link">⚓︎</a></h2>
<p>To compare the performance of DMA with CPU, this project will compare the speed of using <code>memcpy()</code> function and the DMA Memory-to-Memory transfer.</p>
<p>Application target:
- Create a 4KB data block in flash memory (slow peripheral)
- Create a 4KB buffer in SRAM memory (fast peripheral)
- Run CPU <code>memcpy()</code> function to copy from flash to sram
- Run DMA Mem2Mem transfer to copy from flash to sram
- Each operation's duration will be measure by a pulse on GPIO to visual view on a logic analyser</p>
<p>Start a new project, the follow below guide.</p>
<h3 id="61-enable-dma">6.1. Enable DMA<a class="headerlink" href="#61-enable-dma" title="Permanent link">⚓︎</a></h3>
<ol>
<li>Goto <strong>System Core</strong> &gt;&gt; <strong>DMA</strong> peripheral </li>
<li>Add new DMA Request, then select <strong>MEM TO MEM</strong>.</li>
<li>Select DMA Channel, e.g. DMA1 Channel 1</li>
<li>Check the boxes that increase the Source Address and Destination Address, with Data Width as <em>Byte</em> (same as <code>memcpy()</code> function in non-optimized mode)</li>
</ol>
<p>
<figure><img src="ide_enable_dma_mem2mem.png"/><figcaption>Enable DMA in System Core</figcaption>
</figure>
</p>
<h3 id="62-generated-code">6.2. Generated code<a class="headerlink" href="#62-generated-code" title="Permanent link">⚓︎</a></h3>
<p>An instance of <code class="highlight"><span class="n">DMA_HandleTypeDef</span> <span class="n">hdma_memtomem_dma1_channel1</span></code> is created to hold the DMA object.</p>
<p>Then the function <code>MX_DMA_Init()</code> which takes care of setting up the DMA channel enabled in IDE is generated:</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="kt">void</span> <span class="n">MX_DMA_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* DMA controller clock enable */</span>
  <span class="n">__HAL_RCC_DMA1_CLK_ENABLE</span><span class="p">();</span>

  <span class="cm">/* Configure DMA request hdma_memtomem_dma1_channel1 on DMA1_Channel1 */</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Instance</span> <span class="o">=</span> <span class="n">DMA1_Channel1</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">Direction</span> <span class="o">=</span> <span class="n">DMA_MEMORY_TO_MEMORY</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">PeriphInc</span> <span class="o">=</span> <span class="n">DMA_PINC_ENABLE</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">MemInc</span> <span class="o">=</span> <span class="n">DMA_MINC_ENABLE</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">PeriphDataAlignment</span> <span class="o">=</span> <span class="n">DMA_PDATAALIGN_BYTE</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">MemDataAlignment</span> <span class="o">=</span> <span class="n">DMA_MDATAALIGN_BYTE</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">DMA_NORMAL</span><span class="p">;</span>
  <span class="n">hdma_memtomem_dma1_channel1</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="n">DMA_PRIORITY_LOW</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">HAL_DMA_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HAL_OK</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Error_Handler</span><span class="p">(</span> <span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<div class="new-page"></div>
<h3 id="63-user-code">6.3. User code<a class="headerlink" href="#63-user-code" title="Permanent link">⚓︎</a></h3>
<p><strong>Declare memory block</strong></p>
<p>The first step is to declare the data block in the Flash and the buffer in the SRAM.</p>
<div class="admonition hint notitle">
<p class="admonition-title"> </p>
<p>Using <code>const</code> modifier to put variable in to the Flash Memory by Linker. Read more <a href="#">here</a>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="cp">#define TRANSFER_SIZE   4096</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">flash_data</span><span class="p">[</span><span class="n">TRANSFER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="s">"hello"</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">sram_buffer</span><span class="p">[</span><span class="n">TRANSFER_SIZE</span><span class="p">];</span>
</code></pre></div>
<p><strong>Measure execution time</strong></p>
<p>To measure the execution time in a logic analyser, just use any GPIO in to indicate it by raising it to <em>HIGH</em> logic level. For example, on the STM32F0 Disco board, LD3 on PC9 is used.</p>
<p>Test the CPU <code>memcpy()</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_SET</span><span class="p">);</span>
<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sram_buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flash_data</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
</code></pre></div>
<p>Test the DMA Memory-to-Memory transfer, note to use the function <code>HAL_DMA_PollForTransfer()</code> to blocking the CPU execution while DMA is running: </p>
<div class="highlight"><pre><span></span><code><span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_SET</span><span class="p">);</span>
<span class="n">HAL_DMA_Start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">flash_data</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sram_buffer</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">);</span>
<span class="n">HAL_DMA_PollForTransfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="n">HAL_DMA_FULL_TRANSFER</span><span class="p">,</span> <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
<span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
</code></pre></div>
<p>Here are the output pulses showing that <code>memcpy()</code> needs 1192 us to complete while DMA only needs 525 us.</p>
<p>
<figure><img src="compare_memcpy_dma-m2m.png"/><figcaption>Compare between <code>memcpy()</code> and DMA Mem-to-Mem</figcaption>
</figure>
</p>
<div class="new-page"></div>
<h3 id="64-inspect-interrupts">6.4. Inspect interrupts<a class="headerlink" href="#64-inspect-interrupts" title="Permanent link">⚓︎</a></h3>
<p>Now, enable DMA interrupts using IDE by going to <strong>NVIC</strong> sections and check on the row saying that <em>"DMA1 channel 1 interrupt"</em>:</p>
<p>
<figure><img src="ide_dma_interrupt.png"/><figcaption>Enable DMA Interrupt in IDE</figcaption>
</figure>
</p>
<p>Then generate modified code which is newly added into the <em>stm32xxxx_it.c</em> file:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">DMA1_Channel1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">HAL_DMA_IRQHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The function <code>HAL_DMA_IRQHandler()</code> will call to 2 handling functions registered in DMA Handler instance:</p>
<ul>
<li>Half data length callback <code>hdma-&gt;XferHalfCpltCallback()</code></li>
<li>Full data length callback <code>hdma-&gt;XferCpltCallback()</code></li>
</ul>
<p>By default, those callback are not set, therefore, write 2 functions to handle DMA interrupts:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">DMA_HalfTransferCallback</span><span class="p">(</span><span class="n">DMA_HandleTypeDef</span> <span class="o">*</span> <span class="n">_hdma</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD4_GPIO_Port</span><span class="p">,</span> <span class="n">LD4_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_SET</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">DMA_FullTransferCallback</span><span class="p">(</span><span class="n">DMA_HandleTypeDef</span> <span class="o">*</span> <span class="n">_hdma</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD4_GPIO_Port</span><span class="p">,</span> <span class="n">LD4_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
  <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="new-page"></div>
<p>Then register them, and call the DMA Start in Interrupt mode:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

<span class="err">```</span> <span class="n">cpp</span>
  <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_SET</span><span class="p">);</span>
<span class="cp">#ifdef USE_DMA_INTERRUPT</span>
  <span class="n">HAL_DMA_RegisterCallback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="n">HAL_DMA_XFER_HALFCPLT_CB_ID</span><span class="p">,</span> <span class="n">DMA_HalfTransferCallback</span><span class="p">);</span>
  <span class="n">HAL_DMA_RegisterCallback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="n">HAL_DMA_XFER_CPLT_CB_ID</span><span class="p">,</span> <span class="n">DMA_FullTransferCallback</span><span class="p">);</span>
  <span class="n">HAL_DMA_Start_IT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">flash_data</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sram_buffer</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">);</span>
<span class="cp">#else</span>
  <span class="n">HAL_DMA_Start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">flash_data</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sram_buffer</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">);</span>
  <span class="n">HAL_DMA_PollForTransfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_memtomem_dma1_channel1</span><span class="p">,</span> <span class="n">HAL_DMA_FULL_TRANSFER</span><span class="p">,</span> <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
  <span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">,</span> <span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
<span class="cp">#endif</span>
</code></pre></div>
<p>In this case, pin LD3 will show a pulse during DMA a full transfer, while LD4 will show the execution time of the 2<sup>nd</sup> half transfer.</p>
<p>
<figure><img src="compare_memcpy_dma_m2m_isr.png"/><figcaption>The DMA interrupt indicates time execution of the 2<sup>nd</sup> half transfer</figcaption>
</figure>
</p>
<div class="new-page"></div>
<h2 id="7-lab-dma-memory-to-uart-tx">7. Lab: DMA Memory to UART TX<a class="headerlink" href="#7-lab-dma-memory-to-uart-tx" title="Permanent link">⚓︎</a></h2>
<p>This project demonstrates how DMA co-works with CPU to do parallel tasks:</p>
<ul>
<li>CPU will have a main task to blink the LD3 led every 100 ms.</li>
<li>DMA will transfer a 4KB block of data on UART at 9600 bps.</li>
</ul>
<h3 id="71-enable-dma-on-uart-tx">7.1. Enable DMA on UART TX<a class="headerlink" href="#71-enable-dma-on-uart-tx" title="Permanent link">⚓︎</a></h3>
<p>Start a new project and enable USART1 with following settings:</p>
<ul>
<li>Mode: Asynchronous</li>
<li>Mode: 9600 bps, 8-bit data, None parity, 1-bit Stop</li>
<li>In <strong>DMA Settings</strong>, add DMA Request for USART1_TX on DMA1 Channel 2</li>
</ul>
<div class="admonition note notitle">
<p class="admonition-title"> </p>
<p>When enable DMA on a peripheral, DMA interrupt is automatically enabled under <strong>NVIC</strong> settings, and it is also locked by the option <em>Force DMA Channels Interrupt</em>.</p>
</div>
<h3 id="72-generated-code">7.2. Generated code<a class="headerlink" href="#72-generated-code" title="Permanent link">⚓︎</a></h3>
<p>The function <code>MX_DMA_Init()</code> is generated but just to enable DMA Peripheral's clock and DMA Interrupt lines. The setting for DMA on peripheral is moved to the corresponding peripheral's setup functions in this case, they are <code>MX_USART1_UART_Init()</code> → <code>HAL_UART_Init()</code> → <code>HAL_UART_MspInit()</code> (override in <em>stm32xxxx_hal_msp.c</em>):</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">HAL_UART_MspInit</span><span class="p">(</span><span class="n">UART_HandleTypeDef</span><span class="o">*</span> <span class="n">huart</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GPIO_InitTypeDef</span> <span class="n">GPIO_InitStruct</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
  <span class="k">if</span><span class="p">(</span><span class="n">huart</span><span class="o">-&gt;</span><span class="n">Instance</span><span class="o">==</span><span class="n">USART1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">__HAL_RCC_USART1_CLK_ENABLE</span><span class="p">();</span>
    <span class="n">__HAL_RCC_GPIOA_CLK_ENABLE</span><span class="p">();</span>
    <span class="cm">/**USART1 GPIO Configuration</span>
<span class="cm">    PA9     ------&gt; USART1_TX</span>
<span class="cm">    PA10     ------&gt; USART1_RX</span>
<span class="cm">    */</span>
    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Pin</span> <span class="o">=</span> <span class="n">GPIO_PIN_9</span><span class="o">|</span><span class="n">GPIO_PIN_10</span><span class="p">;</span>
    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">GPIO_MODE_AF_PP</span><span class="p">;</span>
    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Pull</span> <span class="o">=</span> <span class="n">GPIO_NOPULL</span><span class="p">;</span>
    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Speed</span> <span class="o">=</span> <span class="n">GPIO_SPEED_FREQ_HIGH</span><span class="p">;</span>
    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Alternate</span> <span class="o">=</span> <span class="n">GPIO_AF1_USART1</span><span class="p">;</span>
    <span class="n">HAL_GPIO_Init</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GPIO_InitStruct</span><span class="p">);</span>

    <span class="cm">/* USART1 DMA Init */</span>
    <span class="cm">/* USART1_TX Init */</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Instance</span> <span class="o">=</span> <span class="n">DMA1_Channel2</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">Direction</span> <span class="o">=</span> <span class="n">DMA_MEMORY_TO_PERIPH</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">PeriphInc</span> <span class="o">=</span> <span class="n">DMA_PINC_DISABLE</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">MemInc</span> <span class="o">=</span> <span class="n">DMA_MINC_ENABLE</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">PeriphDataAlignment</span> <span class="o">=</span> <span class="n">DMA_PDATAALIGN_BYTE</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">MemDataAlignment</span> <span class="o">=</span> <span class="n">DMA_MDATAALIGN_BYTE</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">DMA_NORMAL</span><span class="p">;</span>
    <span class="n">hdma_usart1_tx</span><span class="p">.</span><span class="n">Init</span><span class="p">.</span><span class="n">Priority</span> <span class="o">=</span> <span class="n">DMA_PRIORITY_LOW</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">HAL_DMA_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdma_usart1_tx</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HAL_OK</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Error_Handler</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">__HAL_LINKDMA</span><span class="p">(</span><span class="n">huart</span><span class="p">,</span><span class="n">hdmatx</span><span class="p">,</span><span class="n">hdma_usart1_tx</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Notice the HAL macro <code>__HAL_LINKDMA(huart,hdmatx,hdma_usart1_tx)</code> that is used to link the DMA handler to the peripheral. In fact, it sets the field <code>huart.hdmatx = hdma_usart1_tx</code>, and assign <code>hdma_usart1_tx.Parent = huart</code>. </p>
<p>That linking function helps to link the peripheral's callbacks to  the DMA callbacks of Half data transfer <code>hdma-&gt;XferHalfCpltCallback()</code> and Full data transfer <code>hdma-&gt;XferCpltCallback()</code>.</p>
<h3 id="73-user-code">7.3. User code<a class="headerlink" href="#73-user-code" title="Permanent link">⚓︎</a></h3>
<p>For testing, start with the case that CPU should toggle the LD3 pin and then transfer 4KB data on UART1.</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">);</span>
  <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">,</span> <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Apparently, the LD3 cannot be toggled every 100ms. The transmission on UART takes a long time (~ 4.3s), which causes the execution time of one loop to 4.5 seconds, so it slows down the led blink too much: </p>
<p>
<figure><img src="uart_on_cpu.png"/><figcaption>LED blinking rate is affected by UART transmission</figcaption>
</figure>
</p>
<p>However, when use DMA, the toggling time of the LED is remained at 100 ms. While DMA is executing, new DMA start will be ignored.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LD3_GPIO_Port</span><span class="p">,</span> <span class="n">LD3_Pin</span><span class="p">);</span>
  <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="cp">#if defined(USE_DMA_FOR_UART_TX)</span>
  <span class="n">HAL_UART_Transmit_DMA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">);</span>
<span class="cp">#else</span>
  <span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TRANSFER_SIZE</span><span class="p">,</span> <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>
</code></pre></div>
Here is the result of using DMA, the LD3 is toggled every 100 ms while UART is transmitting data.</p>
<p>
<figure><img src="uart_on_dma.png"/><figcaption>LED blinking is running at desired speed, while UART transmission is handled by DMA</figcaption>
</figure>
</p>
<h2 id="8-lab-dma-peripheral-to-memory">8. Lab: DMA Peripheral to Memory<a class="headerlink" href="#8-lab-dma-peripheral-to-memory" title="Permanent link">⚓︎</a></h2>
<blockquote>
<p>update soon</p>
</blockquote>
<h2 id="__comments">Comments</h2>
<div id="disqus_thread"></div>
<script>var disqus_config=function(){this.page.url="https://www.codeinsideout.com/blog/stm32/dma/",this.page.identifier="blog/stm32/dma/"};window.addEventListener("load",function(){var e=document,i=e.createElement("script");i.src="//vuquangtrong-github-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)})</script>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
</a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a class="md-footer__link md-footer__link--prev" href="../redirection/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Redirection
            </div>
</div>
</a>
<a class="md-footer__link md-footer__link--next" href="../timers/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Timer
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            © 2021 Code Inside Out <div style="display:none"><div>
</div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div style="color: var(--md-footer-fg-color--lighter);">
        using
        <a href="https://github.com/vuquangtrong/mkdocs-material-blog" rel="noopener" target="_blank">
            MkDocs Material Blog
        </a>
        theme
    </div>
</div>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/vuquangtrong" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://facebook.com/trongvq" rel="noopener" target="_blank" title="facebook.com">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><path d="m279.14 288 14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://www.linkedin.com/in/vqtrong" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
<script src="../../../assets/javascripts/bundle.4ea5477f.min.js"></script>
<script src="../../../assets/extra.js"></script>
</body>
</html>